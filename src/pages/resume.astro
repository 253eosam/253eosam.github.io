---
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import ResumeSection from '../components/resume/ResumeSection.astro';
import SkillTag from '../components/resume/SkillTag.astro';
import resume from '../data/resume.json';

const { profile, skills, experience, certifications, education, activities } = resume;
---

<BaseLayout title="이력서" description={`${profile.name} - ${profile.role}`}>
  <Header current="resume" />
  <main class="container resume">
    {/* ── 프로필 ── */}
    <section class="profile">
      <h1 class="profile__name">{profile.name}</h1>
      <p class="profile__role">{profile.role}</p>

      <div class="profile__contact">
        <a href={`mailto:${profile.email}`}>{profile.email}</a>
        {profile.links.map((link) => (
          <a href={link.url} target="_blank" rel="noopener noreferrer">{link.label}</a>
        ))}
      </div>

      <p class="profile__intro">{profile.introduction}</p>

      {profile.highlights && profile.highlights.length > 0 && (
        <ul class="profile__highlights">
          {profile.highlights.map((item) => (
            <li>{item}</li>
          ))}
        </ul>
      )}
    </section>

    {/* ── 기술스택 ── */}
    {skills.length > 0 && (
      <ResumeSection title="기술">
        <div class="skills">
          {skills.map((skill) => (
            <SkillTag label={skill} />
          ))}
        </div>
      </ResumeSection>
    )}

    {/* ── 경력 ── */}
    {experience.length > 0 && (
      <ResumeSection title="경력">
        {experience.map((exp) => (
          <div class="exp">
            <div class="exp__header">
              <div class="exp__info">
                {exp.logo && (
                  <img src={exp.logo} alt={`${exp.company} 로고`} class="exp__logo" width="36" height="36" />
                )}
                <div>
                  <h3 class="exp__company">{exp.company}</h3>
                  <p class="exp__role">{exp.role}{exp.department && ` · ${exp.department}`}</p>
                </div>
              </div>
              <div class="exp__meta">
                <span class="exp__period">{exp.period}</span>
                <span class="exp__sub">{exp.duration}{exp.employmentType && ` · ${exp.employmentType}`}</span>
              </div>
            </div>

            {exp.description && (
              <p class="exp__desc">{exp.description}</p>
            )}

            {exp.projects.map((proj) => (
              <div class="project">
                <div class="project__header">
                  <h4 class="project__name">
                    {proj.url ? (
                      <a href={proj.url} target="_blank" rel="noopener noreferrer">{proj.name} ↗</a>
                    ) : (
                      proj.name
                    )}
                  </h4>
                </div>

                <p class="project__desc">{proj.description}</p>

                {proj.team && (
                  <p class="project__team">{proj.team}</p>
                )}

                {proj.details && proj.details.length > 0 && (
                  <ul class="project__details">
                    {proj.details.map((detail) => (
                      <li>
                        {detail.text}
                        {detail.subItems && detail.subItems.length > 0 && (
                          <ul class="project__sub-details">
                            {detail.subItems.map((sub) => (
                              <li>{sub}</li>
                            ))}
                          </ul>
                        )}
                      </li>
                    ))}
                  </ul>
                )}

                {proj.techStack && proj.techStack.length > 0 && (
                  <div class="project__tech">
                    {proj.techStack.map((tech) => (
                      <SkillTag label={tech} />
                    ))}
                  </div>
                )}
              </div>
            ))}
          </div>
        ))}
      </ResumeSection>
    )}

    {/* ── 자격증 ── */}
    {certifications.length > 0 && (
      <ResumeSection title="자격증">
        {certifications.map((cert) => (
          <div class="row-item">
            <div class="row-item__left">
              <span class="row-item__name">{cert.name}</span>
              <span class="row-item__sub">{cert.organization}</span>
            </div>
            <span class="row-item__date">{cert.date}</span>
          </div>
        ))}
      </ResumeSection>
    )}

    {/* ── 학력 ── */}
    {education.length > 0 && (
      <ResumeSection title="학력">
        {education.map((edu) => (
          <div class="row-item">
            <div class="row-item__left">
              <span class="row-item__name">{edu.institution}</span>
              {edu.major && <span class="row-item__sub">{edu.major}{edu.degree && ` (${edu.degree})`}</span>}
            </div>
            <span class="row-item__date">{edu.period}</span>
          </div>
        ))}
      </ResumeSection>
    )}

    {/* ── 활동 ── */}
    {activities.length > 0 && (
      <ResumeSection title="활동">
        {activities.map((act) => (
          <div class="activity">
            <div class="activity__header">
              <div>
                <h3 class="activity__name">{act.name}</h3>
                <p class="activity__org">{act.organization}</p>
              </div>
              <span class="activity__period">{act.period}</span>
            </div>

            {act.description && (
              <p class="activity__desc">{act.description}</p>
            )}

            {act.details && act.details.length > 0 && (
              <ul class="activity__details">
                {act.details.map((detail) => (
                  <li>{detail}</li>
                ))}
              </ul>
            )}

            {act.link && (
              <a href={act.link.url} target="_blank" rel="noopener noreferrer" class="activity__link">
                {act.link.label} ↗
              </a>
            )}
          </div>
        ))}
      </ResumeSection>
    )}
  </main>
</BaseLayout>

<style>
  /* ── 레이아웃 ── */
  .resume {
    padding-top: var(--space-2xl);
    padding-bottom: var(--space-3xl);
  }

  /* ── 프로필 ── */
  .profile {
    margin-bottom: var(--space-2xl);
  }

  .profile__name {
    font-size: 2.125rem;
    font-weight: 700;
    letter-spacing: -0.02em;
    line-height: 1.2;
  }

  .profile__role {
    font-size: 1.125rem;
    color: var(--color-text-secondary);
    margin-top: var(--space-xs);
  }

  .profile__contact {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-md);
    margin-top: var(--space-md);
    font-size: 0.875rem;
  }

  .profile__contact a {
    color: var(--color-text-secondary);
    text-decoration: none;
  }

  .profile__contact a:hover {
    color: var(--color-accent);
    text-decoration: underline;
  }

  .profile__intro {
    margin-top: var(--space-lg);
    color: var(--color-text-secondary);
    line-height: 1.8;
  }

  .profile__highlights {
    margin-top: var(--space-sm);
    padding-left: var(--space-lg);
    color: var(--color-text-secondary);
    line-height: 1.8;
    font-size: 0.9375rem;
  }

  .profile__highlights li {
    list-style: disc;
  }

  /* ── 기술스택 ── */
  .skills {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-xs);
  }

  /* ── 경력 ── */
  .exp {
    margin-bottom: var(--space-xl);
  }

  .exp:last-child {
    margin-bottom: 0;
  }

  .exp__header {
    display: flex;
    flex-direction: column;
    gap: var(--space-xs);
  }

  .exp__info {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
  }

  .exp__logo {
    width: 36px;
    height: 36px;
    border-radius: var(--radius-sm);
    object-fit: contain;
    flex-shrink: 0;
  }

  .exp__company {
    font-size: 1.25rem;
    font-weight: 700;
    letter-spacing: -0.01em;
  }

  .exp__role {
    font-size: 0.9375rem;
    color: var(--color-text-secondary);
  }

  .exp__meta {
    display: flex;
    flex-direction: column;
    gap: 2px;
  }

  .exp__period {
    font-size: 0.8125rem;
    color: var(--color-text-tertiary);
  }

  .exp__sub {
    font-size: 0.8125rem;
    color: var(--color-text-tertiary);
  }

  .exp__desc {
    margin-top: var(--space-sm);
    color: var(--color-text-secondary);
    font-size: 0.9375rem;
  }

  @media (min-width: 640px) {
    .exp__header {
      flex-direction: row;
      justify-content: space-between;
      align-items: flex-start;
    }

    .exp__meta {
      text-align: right;
      flex-shrink: 0;
    }
  }

  /* ── 프로젝트 ── */
  .project {
    margin-top: var(--space-md);
    padding-left: var(--space-md);
    border-left: 3px solid var(--color-accent);
  }

  .project__header {
    display: flex;
    flex-direction: column;
    gap: var(--space-xs);
  }

  .project__name {
    font-size: 1.0625rem;
    font-weight: 600;
  }

  .project__name a {
    color: inherit;
    text-decoration: none;
  }

  .project__name a:hover {
    color: var(--color-accent);
    text-decoration: underline;
  }

  .project__desc {
    margin-top: var(--space-xs);
    font-size: 0.9375rem;
    color: var(--color-text-secondary);
    line-height: 1.7;
  }

  .project__team {
    margin-top: var(--space-xs);
    font-size: 0.8125rem;
    color: var(--color-text-tertiary);
  }

  .project__details {
    margin-top: var(--space-sm);
    padding-left: var(--space-lg);
    font-size: 0.9375rem;
    color: var(--color-text-secondary);
    line-height: 1.8;
  }

  .project__details > li {
    list-style: disc;
  }

  .project__sub-details {
    margin-top: 2px;
    padding-left: var(--space-lg);
    font-size: 0.875rem;
    line-height: 1.8;
  }

  .project__sub-details li {
    list-style: circle;
  }

  .project__tech {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-xs);
    margin-top: var(--space-sm);
  }

  /* ── 활동 ── */
  .activity {
    margin-bottom: var(--space-md);
    padding-bottom: var(--space-md);
    border-bottom: 1px solid var(--color-border);
  }

  .activity:last-child {
    border-bottom: none;
    margin-bottom: 0;
    padding-bottom: 0;
  }

  .activity__header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: var(--space-md);
  }

  .activity__name {
    font-size: 1rem;
    font-weight: 600;
  }

  .activity__org {
    font-size: 0.875rem;
    color: var(--color-text-secondary);
    margin-top: 2px;
  }

  .activity__period {
    font-size: 0.8125rem;
    color: var(--color-text-tertiary);
    white-space: nowrap;
    flex-shrink: 0;
  }

  .activity__desc {
    margin-top: var(--space-xs);
    font-size: 0.9375rem;
    color: var(--color-text-secondary);
  }

  .activity__details {
    margin-top: var(--space-xs);
    padding-left: var(--space-lg);
    font-size: 0.875rem;
    color: var(--color-text-secondary);
    line-height: 1.8;
  }

  .activity__details li {
    list-style: disc;
  }

  .activity__link {
    display: inline-block;
    margin-top: var(--space-xs);
    font-size: 0.875rem;
    color: var(--color-accent);
    text-decoration: none;
  }

  .activity__link:hover {
    text-decoration: underline;
  }

  /* ── 공통 Row 아이템 (자격증, 학력) ── */
  .row-item {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    padding-bottom: var(--space-md);
    border-bottom: 1px solid var(--color-border);
    gap: var(--space-md);
  }

  .row-item:last-child {
    border-bottom: none;
    padding-bottom: 0;
  }

  .row-item__left {
    display: flex;
    flex-direction: column;
    gap: 2px;
  }

  .row-item__name {
    font-size: 1rem;
    font-weight: 600;
  }

  .row-item__sub {
    font-size: 0.875rem;
    color: var(--color-text-secondary);
  }

  .row-item__desc {
    font-size: 0.875rem;
    color: var(--color-text-tertiary);
    margin-top: 2px;
  }

  .row-item__date {
    font-size: 0.8125rem;
    color: var(--color-text-tertiary);
    white-space: nowrap;
    flex-shrink: 0;
  }

</style>
